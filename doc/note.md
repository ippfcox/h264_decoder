## 7

### 7.1 以表格形式指定的语法

语法表指定了所有允许的码流的语法的超集。在其他条款中，可以直接或间接地指定对语法的附加约束。

> 注 – 实际的解码器应该实现识别码流入口点的方法，并能够识别和处理不符合规范的码流。识别和处理错误以及其他此类情况的方法在此不作规定。

下表列出了用于描述语法的伪代码示例。当出现syntax_element时，它指定从码流中解析出一个语法元素，并在码流解析过程中将码流指针推进到该语法元素之后的下一个位置。

||Category|Descriptor|
|---|---|---|
|/\*语句可以是具有相关语法类别和描述的语法元素，也可以是用于指定语法元素存在、类型和数量的条件表达式，如以下两个示例所示。\*/|||
|**`syntax_element`**|3|ue(v)|
|`conditioning statement`|||
||||
|/\*用花括号括起来的一组语句是复合语句，并且在功能上被视为单一语句。\*/|||
|`{`|||
|`    statement`|||
|`    statement`|||
|`    ...`|||
|`}`|||
|/\*“while”结构指定对`condition`是否为真进行测试，如果为真，则指定重复执行一个语句（或复合语句），直到`condition`不再为真。\*/|||
|`while(condition)`|||
|`    statement`|||
||||
|/\*“do … while”结构指定先执行一次`statement`，然后测试`condition`是否为真，如果为真，则指定重复执行该语句，直到条件不再为真。\*/|||
|`do`|||
|`    statement`|||
|`while(condition)`|||
||||
|/\*“if … else”结构指定对条件是否为真进行测试，如果条件为真，则指定执行一个主要语句，否则，指定执行一个替代语句。如果不需要执行替代语句，则省略结构中的“else”部分和相关的替代语句。\*/|||
|`if(condition)`|||
|`    primary statement`|||
|`else`|||
|`    alternative statement`|||
||||
|/\*“for”结构指定首先执行一个初始语句，然后测试一个条件，如果条件为真，则指定重复执行一个主要语句，并在每次执行后执行一个后续语句，直到条件不再为真。\*/|||
|`for(initial statement; condition; subsequent statement)`|||
|`    primary statement`|||

### 7.2 语法函数、类别和描述符的规定

这里介绍的函数用于语法描述。这些函数假设存在一个比特流指针，该指针指示解码过程将从比特流中读取的下一个比特的位置。

#### byte_aligned() 函数
- 如果比特流中的当前位置在字节边界上，即比特流中的下一个比特是一个字节的第一个比特，则 byte_aligned() 的返回值为 TRUE。
- 否则，byte_aligned() 的返回值为 FALSE。

#### more_data_in_byte_stream() 函数
该函数仅在附录 B 指定的字节流 NAL 单元语法结构中使用，具体定义如下：
- 如果字节流中还有更多数据，more_data_in_byte_stream() 的返回值为 TRUE。
- 否则，more_data_in_byte_stream() 的返回值为 FALSE。

#### more_rbsp_data() 函数
- 如果 RBSP 中没有更多数据，more_rbsp_data() 的返回值为 FALSE。
- 否则，在 RBSP 中搜索最后一个（最低有效的、最右边的）比特等于 1 的位置，该比特是 rbsp_trailing_bits() 语法结构中的第一个比特（rbsp_stop_one_bit）。根据该比特的位置，以下情况适用：
  - 如果 RBSP 中在 rbsp_trailing_bits() 语法结构之前有更多数据，more_rbsp_data() 的返回值为 TRUE。
  - 否则，more_rbsp_data() 的返回值为 FALSE。

用于确定 RBSP 中是否有更多数据的方法由应用程序指定（或在使用字节流格式的应用程序中由附录 B 指定）。

#### more_rbsp_trailing_data() 函数
- 如果 RBSP 中有更多数据，more_rbsp_trailing_data() 的返回值为 TRUE。
- 否则，more_rbsp_trailing_data() 的返回值为 FALSE。

#### next_bits(n) 函数
该函数在不推进比特流指针的情况下提供比特流中的下 n 个比特供比较使用。提供对比特流中下 n 个比特的查看，n 是其参数。在附录 B 指定的字节流中使用时，如果字节流中剩余的比特少于 n，比特流中返回值为 0。

#### read_bits(n) 函数
读取比特流中的下 n 个比特，并将比特流指针前进 n 个比特位置。当 n 等于 0 时，read_bits(n) 指定返回值等于 0，并且不前进比特流指针。

### 类别（C）
类别（在表中标记为 C）指定切片数据最多划分为三个切片数据分区。切片数据分区 A 包含所有类别 2 的语法元素。切片数据分区 B 包含所有类别 3 的语法元素。切片数据分区 C 包含所有类别 4 的语法元素。其他类别值的含义未作规定。对于某些语法元素，使用两个类别值（用竖线分隔）。在这些情况下，进一步在文本中指定应用的类别值。对于在其他语法结构中使用的语法结构，列出了包含的语法结构中的所有语法元素的类别，用竖线分隔。类别标记为“All”的语法元素或语法结构存在于包含该语法元素或语法结构的所有语法结构中。对于在其他语法结构中使用的语法结构，在包含类别标记为“All”的语法元素的语法结构的位置提供的数值类别被认为适用于类别“All”的语法元素。